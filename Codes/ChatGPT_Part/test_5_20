def answer(query, text):
    model = "gpt-3.5-turbo"
    query = query + "\n대화 : " + text

    # 메시지 설정하기
    messages = [
            {"role": "system", "content": "당신은 대화를 읽고 주어진 조건에 대해 답하여라"},
            {"role": "user", "content": query}
    ]

    # ChatGPT API 호출하기
    response = openai.ChatCompletion.create(
        model=model,
        messages=messages
    )
    answer = response['choices'][0]['message']['content']
    print(answer)



query = '''
조건1: 주어진 대화에서 상대방의 감정을 상하게 할 수 있는 발화들을 모두 찾아봐
조건2: 조건1에서 찾은 발화가 왜 문제가 있는지 이유를 알려줘
조건3: 조건2에서 찾은 이유를 고려해서, 조건1에서 찾은 모든 발화들만 개선시켜봐. 이때 미사여구는 빼고 개선된 발화만 정리해서 보여줘
'''

text = '''
speaker 0 :  뭐 니가 봤을 때 내가 살아가는 사람들이랑 문제가 크게 돼 보이나?
speaker 1 :  문제가 크게 되는 사람 이거 있잖아.
speaker 0 :  그런 부분에서만 개선을 하면 되지.
speaker 0 :  이거는 개선점이 있지만
speaker 0 :  우리 어머니 아버지처럼 가난을 물려줘야 되는 거면
speaker 0 :  그거는 개선점이 없다 본다.
speaker 1 :  가난이랑은 또 다른 문제지.
speaker 0 :  얘 봐 또 말 못 알아줬잖아.
speaker 1 :  그럼 다시 얘기해.
speaker 0 :  니 어디 뭐 교수님이야?
speaker 0 :  개선점이 있다고 했잖아.
speaker 0 :  근데 경제적인 것들은 쉽지가 않다고.
speaker 1 :  응.
speaker 0 :  뭔데 이해 똑바로 했나?
speaker 1 :  아니.
speaker 0 :  아 머리 진짜 아프다.
speaker 0 :  이해 못하는 게 내 탓이야.
speaker 0 :  내가 어려웠니 방금?
speaker 1 :  나는 평소에도 오빠 말이 어려워.
speaker 0 :  얘기를 해 봐봐.
speaker 0 :  내가 다시 설명해 줄 테니까.
speaker 1 :  가난을 되물려주지 않기 위해.
speaker 0 :  그 앞에 내가 뭐라 했는데
speaker 0 :  바로 정확하게 찍지는 못하네.
speaker 1 :  뭐라 했는데?
speaker 0 :  아니.
'''

answer(query, text)

===================================================================================================================================================================================================
결과


조건1: 
- "뭐 니가 봤을 때 내가 살아가는 사람들이랑 문제가 크게 돼 보이나?"
- "그런 부분에서만 개선을 하면 되지."
- "우리 어머니 아버지처럼 가난을 물려줘야 되는 거면"
- "얘 봐 또 말 못 알아줬잖아."
- "뭐데 이해 똑바로 했나?"
- "아머리 진짜 아프다."
- "이해 못하는 게 내 탓이야."
- "내가 어려웠니 방금?"
- "나는 평소에도 오빠 말이 어려워."
- "그 앞에 내가 뭐라 했는데 바로 정확하게 찍지는 못하네."

조건2: 
- "뭐 니가 봤을 때 내가 살아가는 사람들이랑 문제가 크게 돼 보이나?" : 이 발화는 누군가를 비판하는 발화로 상대방의 감정을 상하게 할 수 있습니다.
- "우리 어머니 아버지처럼 가난을 물려줘야 되는 거면" : 이 발화는 가난을 상대방이 물려받을 가능성이 있어 공감 대상이 될 수 있는 상황에서 사용하면 상대방의 감정을 상하게 할 수 있습니다.
- "얘 봐 또 말 못 알아줬잖아." : 이 발화는 상대방의 이해력을 조롱하는 발화로 상대방의 감정을 상하게 할 수 있습니다.
- "뭐라 했는데?" : 이 발화는 상대방의 이해력이 좋지 않다는 것을 지적하는 발화로 상대방의 감정을 상하게 할 수 있습니다.
- "아머리 진짜 아프다." : 이 발화는 상대방의 말이나 상황에 대한 불만이나 불쾌감을 표현하는 발화로 상대방의 감정을 상하게 할 수 있습니다.
- "이해 못하는 게 내 탓이야." : 이 발화는 상대방을 비난하는 발화로 상대방의 감정을 상하게 할 수 있습니다.
- "내가 어려웠니 방금?" : 이 발화는 상대방의 이해력에 대한 비난이나 의심을 불러일으키는 발화로 상대방의 감정을 상하게 할 수 있습니다.
- "나는 평소에도 오빠 말이 어려워." : 이 발화는 상대방의 말에 대한 비난이나 의심을 불러일으키는 발화로 상대방의 감정을 상하게 할 수 있습니다.
- "그 앞에 내가 뭐라 했는데 바로 정확하게 찍지는 못하네." : 이 발화는 상대방의 이해력을 비난하는 것으로 상대방의 감정을 상하게 할 수 있습니다.

조건3: 
- "뭐 니가 생각해?" -> 상대방의 의견을 존중하고 들어보는 발화
- "이 부분은 어떻게 개선할 수 있을지 생각해봤어?" -> 대화 상대방의 참여를 유도하는 발화
- "가난 문제를 개선하는 것도 중요하지만, 다른 문제도 있는 거 같아." -> 상대방의 발언을 인용하고 대화 내용에 대해서도 생각하고 있는 것을 보여주는 발화
- "어머니 아버지처럼 가난을 물려주지 않고, 더 좋은 환경에서 자라도록 도와야겠다고 생각해." -> 가난을 다루는 발화인데도, 상대방을 불편하게 하지 않으면서 상대방의 감정을 고려한 개선된 발화
- "미안해, 내가 이해시켜주지 못한 게 내 탓이었어." -> 책임을 전가하지 않고 사과하는 발화
- "내가 설명하기 어렵게 했던 거 같아. 다시 한 번 설명해볼게." -> 상대방의 이해력을 인증하지 않고 참여적이면서도 존중하는 발화


===================================================================================================================================================================================================
1. 돌릴때마다 결과가 다름 and 출력 형식도 다름


***** 개선된 버전

def answer(query, text):
    model = "gpt-3.5-turbo"
    query = query + "\n대화 : " + text

    # 메시지 설정하기
    messages = [
            {"role": "system", "content": "주어진 조건을 만족하는 답변을 해야한다"},
            {"role": "assistant", "content": "어떻게 해야 좋은 대화를 할 수 있는지에 대해서 모든 문헌들을 참고해서 학습해라"},
            {"role": "user", "content": query}
    ]

    # ChatGPT API 호출하기
    response = openai.ChatCompletion.create(
        model=model,
        messages=messages
    )
    answer = response['choices'][0]['message']['content']
    print(answer)



query = '''
조건1: 주어진 대화에서 상대방의 기분을 상하게 할 수 있는 발화들을 모두 찾아봐
조건2: 조건1에서 찾은 발화가 왜 문제가 있는지 이유를 알려줘
조건3: 조건2에서 찾은 문제점들을 고려해서, 조건1에서 찾은 모든 발화만 개선시켜봐. 이때 미사여구는 빼고 개선된 발화만 정리해서 보여줘
'''


text = '''
speaker 0 :  뭐 니가 봤을 때 내가 살아가는 사람들이랑 문제가 크게 돼 보이나?
speaker 1 :  문제가 크게 되는 사람 이거 있잖아.
speaker 0 :  그런 부분에서만 개선을 하면 되지.
speaker 0 :  이거는 개선점이 있지만
speaker 0 :  우리 어머니 아버지처럼 가난을 물려줘야 되는 거면
speaker 0 :  그거는 개선점이 없다 본다.
speaker 1 :  가난이랑은 또 다른 문제지.
speaker 0 :  얘 봐 또 말 못 알아줬잖아.
speaker 1 :  그럼 다시 얘기해.
speaker 0 :  니 어디 뭐 교수님이야?
speaker 0 :  개선점이 있다고 했잖아.
speaker 0 :  근데 경제적인 것들은 쉽지가 않다고.
speaker 1 :  응.
speaker 0 :  뭔데 이해 똑바로 했나?
speaker 1 :  아니.
speaker 0 :  아 머리 진짜 아프다.
speaker 0 :  이해 못하는 게 내 탓이야.
speaker 0 :  내가 어려웠니 방금?
speaker 1 :  나는 평소에도 오빠 말이 어려워.
speaker 0 :  얘기를 해 봐봐.
speaker 0 :  내가 다시 설명해 줄 테니까.
speaker 1 :  가난을 되물려주지 않기 위해.
speaker 0 :  그 앞에 내가 뭐라 했는데
speaker 0 :  바로 정확하게 찍지는 못하네.
speaker 1 :  뭐라 했는데?
speaker 0 :  아니.
'''

answer(query, text)





결과: 

#####첫 번째 시도

조건1: 
- "뭐 니가 봤을 때 내가 살아가는 사람들이랑 문제가 크게 돼 보이나?" : 상대방이 자신의 시선에 대해 의심을 느낄 수 있다.
- "그런 부분에서만 개선을 하면 되지." : 상대방의 발언을 경시하고 무시하는 톤이 있다.
- "이거는 개선점이 있지만" : 상대방의 발언을 소신없이 받아들이지 않고 일축하는 톤이 있다.
- "그거는 개선점이 없다 본다." : 상대방의 의견을 단정적으로 평가하고 그 결론에 도달하는데 있어서 상대방의 입장을 고려하지 않은 것 같다.
- "얘 봐 또 말 못 알아줬잖아." : 상대방의 이해력을 떨어뜨리는 발언이다.
- "아 머리 진짜 아프다." : 상대방이 적극적으로 대화하도록 유도하지 않고 불만을 토로하는 발언이다.
- "내가 어려웠니 방금?" : 상대방의 이해력을 공격적인 톤으로 비난하는 발언이다.
- "나는 평소에도 오빠 말이 어려워." : 상대방의 자신감을 훼손할 수 있는 발언이다.
- "아니." : 상대방의 발언에 대한 대화의 흐름을 막고, 대화를 중단시키는 발언이다.

조건2: 
상대방의 기분을 상하게 할 수 있는 발화들은 대화의 흐름을 막거나, 상대방의 발언을 경시하거나, 상대방의 이해력을 낮춤으로서 대화를 건설적으로 이끌어가지 못하는 결과를 초래한다. 또한 상대방의 자존감을 훼손하거나, 자신의 의견을 단정적으로 내세우는 것이 문제가 될 수 있다.

조건3: 
- "나의 생각을 말해줄 수 있어?" : 상대방의 의견을 듣고 고민하며 대화를 이끌어가도록 유도하는 발화.
- "네 말씀에 맞아요. 그러나 추가로 생각을 더해볼까요?" : 상대방의 발언을 인정하면서도, 함께 대화를 발전시키는 것을 제안하는 발화.
- "제 생각으로는, 경제적인 문제가 해결되어야 가난을 물려주는 것을 막을 수 있을 것 같아요." : 자신의 의견을 밝히면서도 상대방의 발언을 고려하는 발화.
- "그러나, 경제적인 문제를 해결하는 것이 쉽지 않다는 것은 맞아요. 함께 고민해볼까요?" : 상대방의 발언을 이해하면서도, 대화의 궤도를 유지하며 함께 발전시키는 것을 제안하는 발화.
- "죄송합니다. 제가 더 명확히 설명하지 않아서 혼란스러우셨겠죠. 다시 한 번 설명해드릴게요." : 상대방의 이해를 돕고, 대화의 핵심을 재정립하는 발화.
- "제 말을 좀 더 쉽게 풀어쓸게요. 이해가 되시나요?" : 상대방의 이해를 확인하면서도, 더 나은 대화를 이끌어가도록 유도하는 발화.


#####두 번째 시도

1. 발화 분석:
- speaker 0: "이거는 개선점이 있지만", "얘 봐 또 말 못 알아줬잖아", "뭔데 이해 똑바로 했나?", "아 머리 진짜 아프다", "이해 못하는 게 내 탓이야", "내가 어려웠니 방금?"
- speaker 1: "가난이랑은 또 다른 문제지"
2. 문제점 분석:
- speaker 0이 상대방을 비난하고, 의견차이를 그대로 표현하지 않고 정론을 선언
- speaker 0이 자신의 말에 대한 이해를 위해서만 관심을 가지며, 상대방의 이해를 무시
- speaker 0이 상대방을 평가하며, 소통의 진행과정에서 서로에 대한 존중과 배려가 부족
- speaker 1이 상황을 최대한 방어하며, 단순히 의견 차이만을 강조하고 대화의 진전을 막음
3. 다시 개선된 발화:
- speaker 0: "내 의견과 달라도 어떻게 생각하시는지 듣고 싶어요.", "제가 설명을 더 부연해드릴까요?", "이해하기 어려운 부분이 있다면 더 자세하게 설명해드릴게요."
- speaker 1: "그렇게 생각하신 이유가 있으신 건가요?", "저도 다른 방식으로 생각해볼게요.", "저도 그 방법이 유효할 수 있다는 점에 동의해요."


#####세 번째 시도

조건1: 주어진 대화에서 상대방의 기분을 상하게 할 수 있는 발화들을 모두 찾아봐

- speaker 0 : "얘 봐 또 말 못 알아줬잖아."
- speaker 1 : "아니."
- speaker 0 : "아 머리 진짜 아프다."
- speaker 0 : "이해 못하는 게 내 탓이야."
- speaker 0 : "내가 다시 설명해 줄 테니까."
- speaker 0 : "그 앞에 내가 뭐라 했는데"
- speaker 0 : "바로 정확하게 찍지는 못하네."

조건2: 조건1에서 찾은 발화가 왜 문제가 있는지 이유를 알려줘

조건1에서 찾은 발화들은 상대방에게 스트레스를 유발하고, 상대방의 기분을 상하게 만들 수 있는 발화들이다. speaker 0은 상대방의 이해력에 대해 부정적인 평가를 하고, 상대방을 비난하는 것처럼 들릴 수 있는 발화를 사용하였다. 이러한 발화는 대화 상대방과 좋은 관계를 형성하기 어렵게 만들고, 대화의 긍정적인 분위기를 파괴하는 원인이 될 수 있다.

조건3: 조건2에서 찾은 문제점들을 고려해서, 조건1에서 찾은 모든 발화만 개선시켜봐. 이때 미사여구는 빼고 개선된 발화만 정리해서 보여줘

- speaker 0 : "제가 좀 더 명확하게 설명해 볼게요."
- speaker 1 : "아니라면 다르게 설명해주세요."
- speaker 0 : "죄송해요. 다시 한 번 설명해드릴게요."
- speaker 0 : "그 전에 말씀하신 부분을 한 번 다시 언급해주시겠어요?"
- speaker 0 : "어떻게 이해가 안 가는 부분이 있으셨나요?"
- speaker 0 : "다시 설명해 드릴까요?"
- speaker 1 : "제가 잘못 이해한 거 같아요. 다시 설명해주세요."

개선된 발화들은 상대방에 대한 배려와 존중을 보여주며, 대화 상대방에게 긍정적인 영향을 끼칠 수 있는 발화들로 구성되어 있다. 이러한 발화를 사용하면 대화의 분위기가 좋아지며, 대화 상대방과의 친밀한 관계를 유지할 수 있다.


***평가:
1. {"role": "assistant", "content": "어떻게 해야 좋은 대화를 할 수 있는지에 대해서 모든 문헌들을 참고해서 학습해라"} 을 추가했더니 답변의 질이 약간은 나아진 것 같다




